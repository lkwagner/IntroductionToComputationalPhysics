
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Classifying Galaxies &#8212; Physics 246</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'MachineLearningGalaxies';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Random Walks" href="Random%20Walks.html" />
    <link rel="prev" title="Particle Physics" href="ParticlePhysics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/FD.png" class="logo__image only-light" alt="Physics 246 - Home"/>
    <script>document.write(`<img src="_static/FD.png" class="logo__image only-dark" alt="Physics 246 - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    An Introduction to Modern Computational Physics
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="N_Ways_of_Measuring_PI.html">N ways to measure <span class="math notranslate nohighlight">\(\pi\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="Dynamics.html">Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="OrbitalDynamics.html">Orbital Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exoplanets.html">Exoplanets</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exoplanets_short.html">Exoplanets – shorter version</a></li>
<li class="toctree-l1"><a class="reference internal" href="chaos.html">Chaos</a></li>
<li class="toctree-l1"><a class="reference internal" href="ParticlePhysics.html">Particle Physics</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Classifying Galaxies</a></li>
<li class="toctree-l1"><a class="reference internal" href="Random%20Walks.html">Random Walks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Markov%20Chains.html">Markov Chains</a></li>
<li class="toctree-l1"><a class="reference internal" href="Predator-Prey.html">Predator-Prey</a></li>
<li class="toctree-l1"><a class="reference internal" href="Climate.html">Climate Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="FluidDynamics.html">Fluid Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="QC1.html">Quantum Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="QC2.html">Building a Physical Qubit</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/bkclark/IntroductionToComputationalPhysics/blob/main/IntroductionToComputationalPhysics/MachineLearningGalaxies.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/MachineLearningGalaxies.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Classifying Galaxies</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spring-2025-version">Spring 2025 version</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-machine-learning-on-galaxies">Exercise 1: Machine Learning on Galaxies</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-note-on-the-data">A Note on the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-galaxies">a. Galaxies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b-neural-network">b. Neural Network</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#warning-use-jnp"><span style="color:red">Warning: Use <code class="docutils literal notranslate"><span class="pre">jnp</span></code>!</span></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c-measuring-the-quality-of-the-model">c. Measuring the quality of the model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d-training-using-stochastic-gradient-descent">d. Training using stochastic gradient descent</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#e-testing">e. Testing</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="classifying-galaxies">
<h1>Classifying Galaxies<a class="headerlink" href="#classifying-galaxies" title="Link to this heading">#</a></h1>
<section id="spring-2025-version">
<h2>Spring 2025 version<a class="headerlink" href="#spring-2025-version" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Author:</strong></p></li>
<li><p><strong>Date:</strong></p></li>
<li><p><strong>Time spent on this assignment:</strong></p></li>
</ul>
<p><em>This assignment closely follows a tutorial at the Galaxy Zoo.  You are not allowed to look up that tutorial when completing this assignment.</em></p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jax</span><span class="w"> </span><span class="kn">import</span> <span class="n">jit</span>
<span class="kn">import</span><span class="w">  </span><span class="nn">jax</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.animation</span><span class="w"> </span><span class="kn">import</span> <span class="n">FuncAnimation</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTML</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span><span class="p">;</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">resetMe</span><span class="p">(</span><span class="n">keepList</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">ll</span><span class="o">=%</span><span class="k">who_ls</span>
    <span class="n">keepList</span><span class="o">=</span><span class="n">keepList</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;resetMe&#39;</span><span class="p">,</span><span class="s1">&#39;np&#39;</span><span class="p">,</span><span class="s1">&#39;plt&#39;</span><span class="p">,</span><span class="s1">&#39;math&#39;</span><span class="p">,</span><span class="s1">&#39;FuncAnimation&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;HTML&#39;</span><span class="p">,</span><span class="s1">&#39;itertools&#39;</span><span class="p">,</span><span class="s1">&#39;pickle&#39;</span><span class="p">,</span><span class="s1">&#39;testFunc&#39;</span><span class="p">,</span><span class="s1">&#39;jnp&#39;</span><span class="p">,</span><span class="s1">&#39;jax&#39;</span><span class="p">,</span><span class="s1">&#39;jit&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">iiii</span> <span class="ow">in</span> <span class="n">keepList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">iiii</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
            <span class="n">ll</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">iiii</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">iiii</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
        <span class="n">jjjj</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="o">+</span><span class="n">iiii</span><span class="o">+</span><span class="s2">&quot;$&quot;</span>
        <span class="o">%</span><span class="k">reset_selective</span> -f {jjjj}
    <span class="n">ll</span><span class="o">=%</span><span class="k">who_ls</span>
    <span class="k">return</span>

<span class="c1">## you can set cpu to false if you want to use gpu or tpu</span>
<span class="n">cpu</span><span class="o">=</span><span class="kc">True</span>
<span class="k">if</span> <span class="n">cpu</span><span class="p">:</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s1">&#39;jax_platform_name&#39;</span><span class="p">,</span> <span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
<span class="c1">#    jax.config.update(&quot;jax_enable_x64&quot;, True)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">pass</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">from</span><span class="w"> </span><span class="nn">jax</span><span class="w"> </span><span class="kn">import</span> <span class="n">jit</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">import</span><span class="w">  </span><span class="nn">jax</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;jax&#39;
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="exercise-1-machine-learning-on-galaxies">
<h2>Exercise 1: Machine Learning on Galaxies<a class="headerlink" href="#exercise-1-machine-learning-on-galaxies" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>List of collaborators:</strong></p></li>
<li><p><strong>References you used in developing your code:</strong></p></li>
</ul>
<p>In this assignment, we are going to learn how to automatically classify galaxies using a deep neural network. Our goal will be to take a picture of a galaxy and decide which category it falls into (disc, round, cigar shape, etc).</p>
<p>We are going to get the pictures of our galaxies from the Sloan Digital Sky Survey and the labels from the Galaxy Zoo (where the public hand-categorizes the galaxies).  We will then write and train a neural network to do this classification. Our goal is to be at least 66% accuracy (one can do much better but it requires more work then is reasonable for this assignment).</p>
<p>Let’s start by reading in the data. Run the following command to download a copy of the data we’ll need</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>wget<span class="w"> </span>https://courses.physics.illinois.edu/phys246/fa2020/code/dataG.pkl.gz
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--2021-08-17 01:48:12--  https://courses.physics.illinois.edu/phys246/fa2020/code/dataG.pkl.gz
Resolving courses.physics.illinois.edu (courses.physics.illinois.edu)... 130.126.151.14
Connecting to courses.physics.illinois.edu (courses.physics.illinois.edu)|130.126.151.14|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 84647509 (81M) [application/x-gzip]
Saving to: ‘dataG.pkl.gz.1’

dataG.pkl.gz.1      100%[===================&gt;]  80.73M   136MB/s    in 0.6s    

2021-08-17 01:48:13 (136 MB/s) - ‘dataG.pkl.gz.1’ saved [84647509/84647509]
</pre></div>
</div>
</div>
</details>
</div>
<p>Now we’ll unpack it to the format we need</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gzip</span>
<span class="p">(</span><span class="n">train_images_raw</span><span class="p">,</span><span class="n">train_labels</span><span class="p">,</span><span class="n">test_images_raw</span><span class="p">,</span><span class="n">test_labels</span><span class="p">)</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;dataG.pkl.gz&quot;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 2.02 s, sys: 447 ms, total: 2.46 s
Wall time: 2.47 s
</pre></div>
</div>
</div>
</div>
<p>here’s what you now have:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">train_images_raw</span></code> - images in the training set, shape: (17457, 69, 69, 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train_labels</span></code>     - labels that explain the image classification for the training set</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test_images_raw</span></code>  - images for the test set, shape: (1940,69,69,1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test_labels</span></code>      - labels that explain the image classification for the test set</p></li>
</ul>
<section id="a-note-on-the-data">
<h3>A Note on the data<a class="headerlink" href="#a-note-on-the-data" title="Link to this heading">#</a></h3>
<p>The original data has 3 channels - g,r,i bands - while this dataset has only 1 (g). This set also only includes a subset of labels.</p>
<p>You are welcome to do this assignment with the full channel set and see how well it does; you’ll need to download the full data we’ve provided:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">!</span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">courses</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">illinois</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">phys246</span><span class="o">/</span><span class="n">fa2020</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">pkl</span><span class="o">.</span><span class="n">zip</span>
<span class="err">!</span><span class="n">unzip</span> <span class="n">data</span><span class="o">.</span><span class="n">pkl</span><span class="o">.</span><span class="n">zip</span>
<span class="p">(</span><span class="n">train_images_raw</span><span class="p">,</span><span class="n">train_labels</span><span class="p">,</span><span class="n">test_images_raw</span><span class="p">,</span><span class="n">test_labels</span><span class="p">)</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;data.pkl&quot;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>and then change the reshape commands below. Feel free to reach out to us for help.</p>
</section>
<section id="a-galaxies">
<h3>a. Galaxies<a class="headerlink" href="#a-galaxies" title="Link to this heading">#</a></h3>
<p>Let’s now examine this data a bit.  We are first going to look at the training data.  The training data is what you are going to use to teach your neural network.  The test data is to check how good we are doing after (possibly during) training.  We won’t use it to train, though (this is to avoid overfitting; we want our neural network to learn how to classify galaxies but not memorize everything in the training set).</p>
<p>We will start by plotting some of the galaxy images that we have loaded.  Do <code class="docutils literal notranslate"><span class="pre">plt.matshow(train_images_raw[0,:,:,0])</span></code> (This last <code class="docutils literal notranslate"><span class="pre">:,:,0]</span></code> is because there are three layers to each of these galaxies and we just want to see the first layer. We’ve actually only included this first layer for you to save space, but if you want to use the full data this is necessary)</p>
<p>The <code class="docutils literal notranslate"><span class="pre">g</span></code> band is the grayscale image. To get it to display as such, instead of using false color, you can try using <code class="docutils literal notranslate"><span class="pre">cmap='gray'</span></code> as an argument to <code class="docutils literal notranslate"><span class="pre">matshow</span></code></p>
<div><img src="https://clark.physics.illinois.edu/246img/AnsStart.svg" width=200 align=left alt="Answer (start)"></img><br></div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot me here!</span>
</pre></div>
</div>
</div>
</div>
<div><img src="https://clark.physics.illinois.edu/246img/AnsEnd.svg" width=200 align=left alt="Answer (start)"></img><br></div><p>You should see a galaxy.  Now, let’s see what this galaxy should be classified as.  Go ahead and print out <code class="docutils literal notranslate"><span class="pre">train_labels[0]</span></code>.</p>
<div><img src="https://clark.physics.illinois.edu/246img/AnsStart.svg" width=200 align=left alt="Answer (start)"></img><br></div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## print out the label</span>
</pre></div>
</div>
</div>
</div>
<div><img src="https://clark.physics.illinois.edu/246img/AnsEnd.svg" width=200 align=left alt="Answer (start)"></img><br></div><p>The galaxy dataset labels are given as follows. To make the exercise a little more simple, we have reduced the dataset to galaxies that are only classified as 5 of the types listed below.</p>
<p>Galaxy10 dataset (25753 images)</p>
<ul class="simple">
<li><p>Class 0 (3461 images): Disk, Face-on, No Spiral: <code class="docutils literal notranslate"><span class="pre">[1,0,0,0,0]</span></code></p></li>
<li><p>Class 1 (6997 images): Smooth, Completely round: <code class="docutils literal notranslate"><span class="pre">[0,1,0,0,0]</span></code></p></li>
<li><p>Class 2 (6292 images): Smooth, in-between round: <code class="docutils literal notranslate"><span class="pre">[0,0,1,0,0]</span></code></p></li>
<li><p>Class 3 (394 images): Smooth, Cigar shaped: skipped</p></li>
<li><p>Class 4 (3060 images): Disk, Edge-on, Rounded Bulge: <code class="docutils literal notranslate"><span class="pre">[0,0,0,1,0]</span></code></p></li>
<li><p>Class 5 (17 images): Disk, Edge-on, Boxy Bulge: skipped</p></li>
<li><p>Class 6 (1089 images): Disk, Edge-on, No Bulge: skipped</p></li>
<li><p>Class 7 (1932 images): Disk, Face-on, Tight Spiral: <code class="docutils literal notranslate"><span class="pre">[0,0,0,0,1]</span></code></p></li>
<li><p>Class 8 (1466 images): Disk, Face-on, Medium Spiral</p></li>
<li><p>Class 9 (1045 images): Disk, Face-on, Loose Spiral</p></li>
</ul>
<p><img alt="Galaxy10 dataset" src="https://astronn.readthedocs.io/en/v1.0.1/_images/galaxy10_example.png" /></p>
<p>Let’s instead display the image and label for image 98. We see that instead this is a disk galaxy (<em>this might depend on the randomness used in splitting up the training set so we need to check again when we re-pickle</em>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">train_images_raw</span><span class="p">[</span><span class="mi">98</span><span class="p">,:,:,</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train_labels</span><span class="p">[</span><span class="mi">98</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1. 0. 0. 0. 0.]
</pre></div>
</div>
<img alt="_images/d84158904dde5b443f140a07556e9bcbd4b5b4c682a8eb58649f68c5885a73a6.png" src="_images/d84158904dde5b443f140a07556e9bcbd4b5b4c682a8eb58649f68c5885a73a6.png" />
</div>
</div>
<p>Let’s check the shape of our data.  Go ahead and print out <code class="docutils literal notranslate"><span class="pre">train_images_raw.shape</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">train_images_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(17457, 69, 69, 1)
</pre></div>
</div>
</div>
</div>
<p>We have 17457 images.  Each image is a <span class="math notranslate nohighlight">\(69 \times 69 \times 1\)</span> image.  We are going to give these pictures as inputs to our neural network.  It will be easier to give them a big <span class="math notranslate nohighlight">\(69 \times 69 \times 1 = 4761\)</span> vector then a tensor like this.  Therefore, we should go ahead and reshape our data.  To do this, we can do <code class="docutils literal notranslate"><span class="pre">train_images=train_images_raw.reshape(len(train_images_raw),69*69*1)</span></code>  (Do the same thing for our <code class="docutils literal notranslate"><span class="pre">test_images_raw</span> <span class="pre">data</span></code>).  <strong>You also need to normalize the image data so it’s between 0 and 1.  To do that divide all your vectors by 256</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_images</span> <span class="o">=</span> <span class="n">train_images_raw</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">train_images_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">69</span><span class="o">*</span><span class="mi">69</span><span class="o">*</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">256.</span>
<span class="n">test_images</span>  <span class="o">=</span> <span class="n">test_images_raw</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">test_images_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">69</span><span class="o">*</span><span class="mi">69</span><span class="o">*</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">256.</span>
</pre></div>
</div>
</div>
</div>
<p>We will work with these reshaped vectors for most the rest of this assignment.</p>
</section>
<section id="b-neural-network">
<h3>b. Neural Network<a class="headerlink" href="#b-neural-network" title="Link to this heading">#</a></h3>
<hr class="docutils" />
<section id="warning-use-jnp">
<h4><span style="color:red">Warning: Use <code class="docutils literal notranslate"><span class="pre">jnp</span></code>!</span><a class="headerlink" href="#warning-use-jnp" title="Link to this heading">#</a></h4>
<p>Notice that at the top of the file, we have imported <code class="docutils literal notranslate"><span class="pre">jax.numpy</span> <span class="pre">as</span> <span class="pre">jnp</span></code> alongside regular <code class="docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">as</span> <span class="pre">np</span></code>. To proceed with this assignment, you now need to start using <code class="docutils literal notranslate"><span class="pre">jnp</span></code> instead of <code class="docutils literal notranslate"><span class="pre">np</span></code>. It’s a drop-in replacement for all functions (<code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">log</span></code>, etc.) that you’ll normally use in numpy but is required for the fancy gradient calculations necessary for training your net.</p>
<hr class="docutils" />
<p>Our next step is to write a neural network.   A neural network might sound complicated but it’s actually really simple.  All our neural network does is take the input vector (our reshaped image) to an output vector (of size 5 because we have five different ways to classify a galaxy).</p>
<p>The equation for how to do this is
<span class="math notranslate nohighlight">\(v_{out} = 1.0/(1+\exp(-(W_2 \textrm{tanh}(W_1 v_{in} + b_1) +b_2))\)</span>
where</p>
<ul class="simple">
<li><p>W1 is a size d x 4761 matrix</p></li>
<li><p>W2 is a size 5 x d matrix</p></li>
<li><p>b1 is a size d  matrix</p></li>
<li><p>b2 is a size 5  matrix</p></li>
</ul>
<p>The last term: <span class="math notranslate nohighlight">\(1/(1+e^{-x})\)</span> ensures that all the numbers in <span class="math notranslate nohighlight">\(v_{out}\)</span> are between 0 and 1.</p>
<p>Implement a function</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">net</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">imageVector</span><span class="p">):</span>
   <span class="n">a1</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">W1</span><span class="nd">@imageVector</span>
   <span class="c1"># other computations</span>
   <span class="c1"># return output</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">p</span></code> is a NamedTuple that contains these parameters and imageVector is one of our reshaped images.</p>
<p>You can define and initialize the NamedTuple as follows (keep in mind that you may need to change this):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NamedTuple</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Params</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">W1</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span>  <span class="c1"># d x 4761</span>
    <span class="n">b1</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">W2</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">b2</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span>

<span class="n">d</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">12423</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Params</span><span class="p">(</span><span class="n">W1</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">69</span><span class="o">*</span><span class="mi">69</span><span class="o">*</span><span class="mi">1</span><span class="p">)),</span>
           <span class="n">b1</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">d</span><span class="p">,)),</span>
           <span class="n">W2</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">d</span><span class="p">)),</span>
           <span class="n">b2</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

</pre></div>
</div>
<p>You can access the variables by using <code class="docutils literal notranslate"><span class="pre">p.b1</span></code> etc.</p>
<p>Let’s test this out.  Generate a set of random parameters that have the correct dimension.   Then call <code class="docutils literal notranslate"><span class="pre">net(params,train_images[3])</span></code> and you should get what your current neural network guesses is the classification for the “3’rd” galaxy.  Use <span class="math notranslate nohighlight">\(d=100\)</span>.</p>
<div><img src="https://clark.physics.illinois.edu/246img/AnsStart.svg" width=200 align=left alt="Answer (start)"></img><br></div><p>Q: Compare your prediction to the actual classification for image 3. Is it making a good prediction? Why or why not?</p>
<p>A:</p>
<div><img src="https://clark.physics.illinois.edu/246img/AnsEnd.svg" width=200 align=left alt="Answer (start)"></img><br></div><p>Notice that the output isn’t a nice vector like <code class="docutils literal notranslate"><span class="pre">[0,0,0,0,1]</span></code>. Instead, it has five different numbers between zero and one such as <code class="docutils literal notranslate"><span class="pre">[0.2400989</span> <span class="pre">,</span> <span class="pre">0.39862376,</span> <span class="pre">0.4565858</span> <span class="pre">,</span> <span class="pre">0.286503</span>&#160; <span class="pre">,</span> <span class="pre">0.734855</span>&#160; <span class="pre">]</span></code>  We will say that the neural network classifies the galaxy by whichever index is largest i.e. <code class="docutils literal notranslate"><span class="pre">np.argmax(outputVector)</span></code>. In this case it is the 0.8866 which corresponds to spot 4 or “Disk Edge on- rounded bulge” category.</p>
</section>
</section>
<section id="c-measuring-the-quality-of-the-model">
<h3>c. Measuring the quality of the model<a class="headerlink" href="#c-measuring-the-quality-of-the-model" title="Link to this heading">#</a></h3>
<p>To quantify how good our neural network is, we will use two things:</p>
<p>(1) <strong>Cross-entropy</strong>
Let’s quantify how far off you are from the expected label (maybe it’s <code class="docutils literal notranslate"><span class="pre">[0,0,0,1,0]</span></code>) . A good way to quantify this is to use the cross entropy.  The cross-entropy is defined as</p>
<div class="math notranslate nohighlight">
\[ \sum_i -y_i \log(a_i) - (1-y_i)\log(1-a_i)\]</div>
<p>where <span class="math notranslate nohighlight">\(y_i\)</span> is the <span class="math notranslate nohighlight">\(i'\)</span>th component of the exact label and <span class="math notranslate nohighlight">\(a_i\)</span> is the <span class="math notranslate nohighlight">\(i'\)</span>th component of the label you get as output from the neural network.</p>
<p>Write a function
<code class="docutils literal notranslate"><span class="pre">loss(params,</span> <span class="pre">imageVector,</span> <span class="pre">correctLabel)</span></code> that takes the parameters and the <code class="docutils literal notranslate"><span class="pre">imageVector</span></code>, runs the neural network to get the output <code class="docutils literal notranslate"><span class="pre">a</span></code> (i.e. <code class="docutils literal notranslate"><span class="pre">a=net(params,imageVector)</span></code>) and then returns the cross entropy.  Check the cross entropy you are getting. Our goal will be to minimize this cross entropy (if we do this, then our network will do a better job of getting the correct galaxy classification)</p>
<div><img src="https://clark.physics.illinois.edu/246img/AnsStart.svg" width=200 align=left alt="Answer (start)"></img><br></div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##</span>
</pre></div>
</div>
</div>
</div>
<div><img src="https://clark.physics.illinois.edu/246img/AnsEnd.svg" width=200 align=left alt="Answer (start)"></img><br></div><p>(2) <strong>Correct classification</strong>
In addition to the cross-entropy, we care whether the winning labelling is correct. We will say that we’ve labelled it correctly if in our length 10 vector, the maximum value is where the 1 should be.  Write a function <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">accuracy(params,image,label)</span></code> that says whether a single image  you got correct. (<code class="docutils literal notranslate"><span class="pre">jnp.argmax</span></code> is probably useful here).  Run this on your test images and labels.</p>
<p>Show that your accuracy function correctly computes whether the classification is correct for one or two image examples.</p>
<p>Once you can compute whether a single image correctly classifies, <code class="docutils literal notranslate"><span class="pre">jax</span></code> makes it easy to extend it to many images. Define</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fractionCorrect</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">in_axes</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p>This makes <code class="docutils literal notranslate"><span class="pre">fractionCorrect</span></code> into a function, in which the second and third argument now have an extra dimension. Whereas you called accuracy as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">accuracy</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">train_images</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">train_labels</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<p>you will instead call <code class="docutils literal notranslate"><span class="pre">fractionCorrect</span></code> as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fractionCorrect</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">train_images</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
</pre></div>
</div>
<p>and it will return an array for <strong>all</strong> the images. You can then take the mean as <code class="docutils literal notranslate"><span class="pre">jnp.mean</span></code> for the fraction.</p>
<div><img src="https://clark.physics.illinois.edu/246img/AnsStart.svg" width=200 align=left alt="Answer (start)"></img><br></div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">###</span>
</pre></div>
</div>
</div>
</div>
<div><img src="https://clark.physics.illinois.edu/246img/AnsEnd.svg" width=200 align=left alt="Answer (start)"></img><br></div><p>You probably got about 30% correct with your random values of <code class="docutils literal notranslate"><span class="pre">w1,b1,w2,b2</span></code>. Now we have to do better.  We are going to work on getting our loss down (and this will get our fractionCorrect down).  Getting the loss down is easier because it depends continuously on the parameters).</p>
<p>To make an objective function better, what we should do is to step in a direction where it gets better.  To do this, we are going to want to get the gradient.  We can use jax to get the gradient as we have in earlier assignments.</p>
<p>Let’s define the gradient of the loss as
<code class="docutils literal notranslate"><span class="pre">loss_grad</span> <span class="pre">=</span> <span class="pre">jit(jax.grad(jit(loss)))</span></code>.  (The <code class="docutils literal notranslate"><span class="pre">jit</span></code> are there to make things faster.  This is morally just <code class="docutils literal notranslate"><span class="pre">jax.grad(loss)</span></code> and that would work albeit be slower).</p>
</section>
<section id="d-training-using-stochastic-gradient-descent">
<h3>d. Training using stochastic gradient descent<a class="headerlink" href="#d-training-using-stochastic-gradient-descent" title="Link to this heading">#</a></h3>
<p>Now all we need to do is to (over and over again)</p>
<ul class="simple">
<li><p>choose a random image in the <strong>training</strong> set.</p></li>
<li><p>compute the gradient</p></li>
<li><p>change the parameters by 0.1% of the gradient (called the <em>learning rate</em> <span class="math notranslate nohighlight">\(\eta\)</span>)</p></li>
</ul>
<p>This will make your result on this image marginally better.</p>
<p>Every 2000 steps you might want to check the fraction of your test set that is now correct. Print it out as well as push it to a list.  You should find that your accuracy rises from 30% beyond 66%.  Plot your accuracy as a function of step for at least 50*2000, and if patient out to 100*2000.</p>
<div><img src="https://clark.physics.illinois.edu/246img/AnsStart.svg" width=200 align=left alt="Answer (start)"></img><br></div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="e-testing">
<h3>e. Testing<a class="headerlink" href="#e-testing" title="Link to this heading">#</a></h3>
<p>By this point you should have a somewhat accurate classifier. 66% is not great for production work; you can do better by improving your training and the size of your network, but to keep the assignment reasonable we will stop there.</p>
<p>Now we would like to know how accurate we would expect our model to be on data it’s never seen before. You can’t use the data you trained on because your model has already seen it; we want to make sure that it’s not just memorizing the data that it’s already seen (this is sometimes referred to as overfitting). This is where the test data comes in. Use your <code class="docutils literal notranslate"><span class="pre">fractionCorrect</span></code> function to assess how good your model is on the test data set.</p>
<p>Q: Did you overfit your model? Why or why not?</p>
<p>A:</p>
<div><img src="https://clark.physics.illinois.edu/246img/AnsEnd.svg" width=200 align=left alt="Answer (start)"></img><br></div><p><strong>Acknowledgement:</strong> This assignment follows very closely a tutorial from GalaxyZoo.com</p>
<ul class="simple">
<li><p>Bryan Clark and Ryan Levy (original)</p></li>
</ul>
<p>Copyright: 2021</p>
<hr class="docutils" />
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ParticlePhysics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Particle Physics</p>
      </div>
    </a>
    <a class="right-next"
       href="Random%20Walks.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Random Walks</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spring-2025-version">Spring 2025 version</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-machine-learning-on-galaxies">Exercise 1: Machine Learning on Galaxies</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-note-on-the-data">A Note on the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-galaxies">a. Galaxies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b-neural-network">b. Neural Network</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#warning-use-jnp"><span style="color:red">Warning: Use <code class="docutils literal notranslate"><span class="pre">jnp</span></code>!</span></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c-measuring-the-quality-of-the-model">c. Measuring the quality of the model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d-training-using-stochastic-gradient-descent">d. Training using stochastic gradient descent</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#e-testing">e. Testing</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Bryan Clark; George Gollin; Ryan Levy
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>